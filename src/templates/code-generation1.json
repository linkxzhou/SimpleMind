{"data":{"text":"开发最小化的浏览器的方案和开源库","expand":true,"uid":"05f75fb4-beee-4433-8754-0f94f54bd080","isActive":false},"children":[{"data":{"text":"核心架构设计：浏览器引擎选型与最小化架构","note":"最小化浏览器的核心在于选择轻量级渲染引擎和精简架构。主流方案包括：Chromium Embedded Framework (CEF)提供完整功能但体积大；WebKitGTK适合Linux环境；Servo采用Rust编写，模块化程度高；Ultralight基于GPU加速，体积仅数MB；LiteHTML专注HTML/CSS渲染无JS引擎。最小化架构应剥离不必要的组件：移除扩展系统、开发者工具、同步服务、PDF阅读器、多媒体解码器等，仅保留URL解析、网络请求、HTML解析、CSS渲染、基础JS执行等核心模块。","nextSystemPrompt":"基于CEF、Ultralight、WebKit、Servo等引擎选型，分析各方案的最小化实现路径、体积优化策略和适用场景","color":"#8B0A50","expand":true,"richText":false,"isActive":false,"uid":"363fffa5-d0ae-46f0-9085-5175167a6378","dir":"right"},"children":[{"data":{"text":"CEF精简方案：基于Chromium的裁剪实践","note":"CEF (Chromium Embedded Framework) 提供完整的Chromium功能，但通过编译选项可大幅裁剪。关键配置：关闭ffmpeg减少30MB+、禁用ANGLE和SwiftShader、移除Widevine DRM、关闭打印预览和PDF功能、禁用扩展和插件系统。使用`gn gen`配合自定义args.gn：is_official_build=true, symbol_level=0, remove_webcore_debug_symbols=true, enable_media=false。最终可控制在50-80MB，适合需要完整Web兼容性的场景。","nextSystemPrompt":"分析CEF编译参数优化、静态链接策略、自定义资源打包、启动速度优化等具体实现","color":"#4A0080","expand":true,"richText":false,"isActive":false,"uid":"a28388b1-4f28-4a65-bfb7-8302b89d56d1"},"children":[]},{"data":{"text":"Ultralight方案：GPU加速的轻量引擎","note":"Ultralight是专为嵌入式和桌面应用设计的轻量级GPU加速HTML UI引擎。核心优势：无庞大依赖、单头文件API、支持现代CSS3和ES6子集、体积<10MB。架构采用GPU命令缓冲和矢量光栅化，替代传统DOM+软件渲染。适合需要现代UI但不需要完整Web平台的场景，如游戏内嵌UI、桌面工具。限制：不支持完整DOM API、部分CSS特性缺失、JS通过JSC或V8绑定。","nextSystemPrompt":"深入Ultralight的GPU渲染管线、JS绑定机制、资源加载器定制、与原生窗口系统集成方案","color":"#006B3C","expand":true,"richText":false,"isActive":false,"uid":"0f5a0399-3795-4711-9709-ec36c970db7d"},"children":[]},{"data":{"text":"WebKitGTK/WPE方案：Linux嵌入式首选","note":"WebKitGTK是GTK平台上的WebKit移植，WPE是面向嵌入式的新端口。WPE特别优化：使用Wayland/EGLFS替代X11、支持多后端（FDO、Broadcom、Intel等）、内存占用<100MB。编译关键：-DENABLE_VIDEO=OFF -DENABLE_WEB_AUDIO=OFF -DENABLE_GEOLOCATION=OFF -DENABLE_SPELLCHECK=OFF。使用Flatpak或静态链接控制依赖。WPE的C API简洁，适合集成到自定义窗口系统。","nextSystemPrompt":"分析WPE后端移植、内存池优化、Wayland集成、跨平台构建脚本设计","color":"#B35900","expand":true,"richText":false,"isActive":false,"uid":"37219aec-9cf4-4e5b-8776-8a3fb4006d12"},"children":[]},{"data":{"text":"Servo方案：Rust编写的实验性引擎","note":"Servo是Mozilla用Rust编写的并行浏览器引擎，虽实验性但模块化设计优秀。核心创新：并行CSS样式计算、并行布局、GPU渲染（WebRender）。最小化使用：仅引入servo-webrender作为渲染后端，或嵌入servo作为组件。Rust的内存安全保证减少崩溃风险。当前局限：部分Web标准支持不完整、社区维护力度下降。适合技术探索和安全敏感场景。","nextSystemPrompt":"探索Servo组件化使用、WebRender集成、Rust FFI绑定、与现有C++代码库集成方案","color":"#8B4513","expand":true,"richText":false,"isActive":false,"uid":"2e40d639-f921-434d-8ea6-a4c50ff9d8f6"},"children":[]},{"data":{"text":"LiteHTML方案：纯HTML/CSS渲染无JS","note":"LiteHTML是轻量级HTML/CSS渲染引擎，专为嵌入式和电子墨水设备设计。特点：无JS引擎、纯C++实现、依赖仅GDI或Cairo、体积<1MB。支持HTML4/CSS2.1子集，适合显示静态内容或预渲染页面。架构：自定义document容器接口，开发者实现资源加载和绘制回调。典型应用：邮件客户端、电子书阅读器、工业HMI界面。需配合外部JS引擎（如QuickJS）实现动态功能。","nextSystemPrompt":"设计LiteHTML的document容器实现、CSS解析扩展、与QuickJS集成、自定义标签支持方案","color":"#2F4F4F","expand":true,"richText":false,"isActive":false,"uid":"1df19f1d-b99a-4664-8bce-c60158ccafe5"},"children":[]},{"data":{"text":"网络层精简：自定义协议栈与缓存","note":"浏览器网络层是体积和复杂度的主要来源。最小化策略：替换libcurl/cronet为自定义实现，仅支持HTTP/1.1和HTTP/2基础功能；禁用QUIC、WebSocket、WebRTC；静态链接OpenSSL或改用mbedtls（-200KB）；实现极简磁盘缓存（LRU，无SQLite）；DNS预解析和连接池按需启用。关键代码：使用epoll/kqueue/IOCP实现异步IO，避免libevent等重型库。","nextSystemPrompt":"实现自定义HTTP客户端、TLS握手优化、缓存索引结构设计、资源优先级调度算法","color":"#483D8B","expand":true,"richText":false,"isActive":false,"uid":"c62b03a9-1f79-4c97-8fa8-9b198aaca011"},"children":[]},{"data":{"text":"JS引擎选择：从V8到QuickJS的权衡","note":"JS引擎是体积大户：V8完整版>10MB，JSC>5MB，QuickJS仅500KB。最小化方案：静态场景用LiteHTML无JS；配置界面用JSON+绑定；简单交互用QuickJS（ES2020支持，启动<10ms）；完整Web应用选V8 Lite模式或JSC。QuickJS特别适合：通过C模块扩展、快照序列化加速启动、内存限制环境。V8 Lite通过--lite-mode、禁用JIT、共享快照可减少60%内存。","nextSystemPrompt":"对比QuickJS与V8 Lite的API绑定、性能基准、内存管理、调试支持实现细节","color":"#006400","expand":true,"richText":false,"isActive":false,"uid":"4bbf2b51-2a85-46f7-be7c-49c11085b30d"},"children":[]}]},{"data":{"text":"开源库集成：核心功能模块选型","note":"最小化浏览器依赖精选开源库，每个模块选择体积与功能平衡的方案。关键原则：优先C/C++库避免运行时依赖、静态链接控制符号暴露、自定义构建移除未用功能。核心模块包括：URL解析（ada-url替代WHATWG URL）、HTML解析（Gumbo或lexbor）、CSS解析（LibCSS或自研子集）、图像解码（stb_image替代libpng/libjpeg）、字体渲染（FreeType精简版或stb_truetype）、网络（自研或mbedtls+curl定制）。","nextSystemPrompt":"针对各功能模块，分析库选型对比、构建配置优化、API封装设计、性能测试方法","color":"#191970","expand":true,"richText":false,"isActive":false,"uid":"d16061f0-7e2f-4c76-bf0b-ac618afdd140","dir":"right"},"children":[{"data":{"text":"HTML解析：Gumbo与lexbor的对比实现","note":"Google的Gumbo是纯C HTML5解析器，符合规范但已停止维护，适合稳定需求。lexbor是活跃项目，C语言编写，模块化设计，支持HTML/CSS/DOM，可仅编译HTML模块。lexbor优势：流式解析支持大文档、内存池分配器、自定义标签支持。构建优化：-DLEXBOR_BUILD_SHARED=OFF -DLEXBOR_BUILD_EXAMPLES=OFF -DLEXBOR_BUILD_TESTS=OFF，仅启用HTML和DOM模块，体积可<200KB。Gumbo更轻量（<150KB）但功能固定。","nextSystemPrompt":"实现基于lexbor的DOM树构建、与渲染引擎的桥接、增量解析支持、错误恢复策略","color":"#556B2F","expand":true,"richText":false,"isActive":false,"uid":"1547d701-ea58-40d5-8f07-5baa76b4b1da"},"children":[]},{"data":{"text":"CSS引擎：LibCSS与自研子集引擎","note":"NetSurf的LibCSS是完整CSS2.1实现，C语言，依赖少，但选择器性能一般。最小化方案：仅实现常用子集（标签、类、ID、后代选择器，盒模型、定位、flex布局），自研递归下降解析器+简单匹配引擎，体积<100KB。或使用LightningCSS（Rust）通过wasm或native绑定，获得现代CSS处理。关键优化：样式表预处理为哈希表加速匹配、共享计算样式（computed style）减少内存、增量样式重算。","nextSystemPrompt":"设计CSS解析器状态机、选择器匹配优化、样式继承计算、与布局引擎的对接接口","color":"#8B4513","expand":true,"richText":false,"isActive":false,"uid":"c54867c0-ac19-42d9-b89d-2d5ac165392e"},"children":[]},{"data":{"text":"2D图形渲染：Skia精简与自研光栅化","note":"Skia是Chromium的2D图形库，功能全面但体积大（>5MB）。精简方案：禁用GPU后端、仅保留CPU光栅化、关闭PDF/PS导出、移除复杂特效（路径效果、遮罩滤镜），可压缩至1-2MB。更轻量选择：Blend2D（JIT编译，高性能，<500KB）、AGG（经典抗锯齿，<300KB）、或自研基于stb_image的简易渲染器（<100KB，无矢量抗锯齿）。Ultralight的GPUDriver抽象值得参考，实现跨后端渲染。","nextSystemPrompt":"实现GPU命令缓冲区设计、矢量路径填充算法、字体光栅化集成、脏矩形优化策略","color":"#4B0082","expand":true,"richText":false,"isActive":false,"uid":"61c4f1c8-f7cd-4687-9a3e-0158483e6c1a"},"children":[]},{"data":{"text":"图像解码：stb_image与定制解码器","note":"stb_image是单头文件图像解码库，支持JPEG/PNG/BMP/TGA/GIF，无需依赖，体积<100KB。限制：无渐进解码、内存解码、无EXIF处理。优化：启用STBI_ONLY_PNG等宏裁剪格式、替换malloc为内存池。更高性能：使用qoi（快速无损格式，自研编码）、lodepng（比libpng小且安全）、pjpeg（渐进JPEG）。WebP/AVIF支持需权衡：libwebp+1MB，或等待原生支持。关键：实现异步解码避免阻塞渲染。","nextSystemPrompt":"设计图像解码线程池、内存映射加载、渐进式渲染支持、GPU纹理直接上传","color":"#006666","expand":true,"richText":false,"isActive":false,"uid":"ab1e25aa-522e-4246-a3b1-cd9c9f5b50cb"},"children":[]},{"data":{"text":"字体处理：FreeType精简与字体子集化","note":"FreeType是字体渲染标准，但完整构建>1MB。精简：仅启用SFNT/TrueType支持，禁用CFF/Type1/PCF/BDF，关闭自动提示引擎，体积<400KB。更轻量：stb_truetype（单头文件，<100KB，质量略逊）。字体加载优化：子集化（仅嵌入使用字符）、WOFF2解码（使用woff2库或自研）、系统字体回退链。关键实现：字体匹配算法（CSS font-family到系统字体）、字形缓存（LRU纹理图集）、文本测量与断行。","nextSystemPrompt":"实现字体配置解析、字形纹理图集管理、复杂脚本塑形（HarfBuzz精简集成）、文本布局引擎","color":"#8B0000","expand":true,"richText":false,"isActive":false,"uid":"0cfd81aa-05f9-44d1-b784-1ea43fdd66c7"},"children":[]},{"data":{"text":"网络与存储：curl定制与LevelDB替代","note":"网络层curl精简：--disable-dict --disable-file --disable-ftp --disable-gopher --disable-imap --disable-pop3 --disable-smtp --disable-telnet --disable-tftp，仅保留HTTP/HTTPS，配合mbedtls替代OpenSSL，体积<300KB。存储：SQLite功能过剩，改用LevelDB（键值对，<500KB）或自研日志结构合并树（LSM-Tree）仅支持顺序写。Cookie/LocalStorage实现：内存哈希表+定期持久化，避免复杂事务。缓存：固定大小FIFO磁盘队列，简化索引。","nextSystemPrompt":"实现HTTP/2帧解析、TLS会话恢复、Cookie安全策略、IndexedDB子集支持","color":"#483D8B","expand":true,"richText":false,"isActive":false,"uid":"4b5c89b5-e213-46b5-ab97-5d53bd804e20"},"children":[]}]},{"data":{"text":"项目工程化：构建系统与代码组织","note":"最小化浏览器的工程化需兼顾跨平台构建、快速编译、体积优化。核心策略：使用CMake或Meson作为元构建系统，支持Ninja后端加速；采用Git子模块或FetchContent管理依赖，确保可复现构建；分层架构隔离平台相关代码；条件编译控制功能开关；LTO（链接时优化）和符号剥离减少体积；使用UPX或自定义压缩进一步缩小分发包。关键：单一可执行文件目标，避免动态库依赖地狱。","nextSystemPrompt":"设计CMake模块化配置、跨平台抽象层、CI/CD构建流水线、发布包自动化生成","color":"#2E8B57","expand":true,"richText":false,"isActive":false,"uid":"04bda271-2161-4797-82fd-3481027c9052","dir":"right"},"children":[{"data":{"text":"构建系统：CMake与Ninja优化配置","note":"CMake是C++项目标准，配合Ninja实现快速增量构建。关键配置：使用INTERFACE库抽象模块依赖、target_precompile_headers加速编译、ccache缓存对象文件。交叉编译支持：工具链文件配置Android/嵌入式Linux/iOS。体积优化：-DCMAKE_BUILD_TYPE=MinSizeRel -DCMAKE_INTERPROCEDURAL_OPTIMIZATION=ON，配合-ffunction-sections -fdata-sections和-Wl,--gc-sections移除未用代码。Windows: /MT静态运行时，/OPT:REF /OPT:ICF合并相同代码段。","nextSystemPrompt":"编写可复用的CMake模块、FetchContent依赖管理、vcpkg/conan集成、构建时间优化分析","color":"#4A0080","expand":true,"richText":false,"isActive":false,"uid":"46a053c3-8b16-434d-baa1-b44059a83a65"},"children":[]},{"data":{"text":"代码架构：平台抽象与模块接口设计","note":"分层架构：Platform层（窗口、输入、文件、网络）抽象OS差异；Engine层（渲染、JS、网络）实现核心逻辑；App层（UI、导航、设置）组装功能。关键模式：Pimpl隐藏平台实现、虚接口允许引擎替换、消息循环统一事件处理。目录结构：src/platform/{win,mac,linux,embedded}/, src/engine/{render,js,net}/, src/app/。条件编译：#ifdef ENABLE_JS_ENGINE包裹可选功能。接口稳定性：C API边界便于多语言绑定和版本兼容。","nextSystemPrompt":"设计平台抽象接口、引擎插件架构、消息循环与任务调度、跨线程通信机制","color":"#8B4513","expand":true,"richText":false,"isActive":false,"uid":"3b3c1ecf-c819-432d-94e5-136f16538f94"},"children":[]},{"data":{"text":"编译优化：LTO、PGO与符号管理","note":"链接时优化（LTO）：Clang/LLVM的ThinLTO并行处理，GCC的WHOPR，可内联跨模块函数、移除死代码，通常减少10-20%体积。配置文件引导优化（PGO）：收集典型使用场景的执行频率，优化热路径，提升5-15%性能。符号管理：Release构建使用strip或/STRIPPED移除调试符号；保留最小符号表用于崩溃分析（breakpad/minidump）。进一步：sstrip工具移除ELF多余节区，或使用自定义加载器解压运行时代码。","nextSystemPrompt":"实现PGO训练工作流、崩溃符号化系统、性能剖析集成、自动化体积回归检测","color":"#006B3C","expand":true,"richText":false,"isActive":false,"uid":"36b4930e-80e6-4c4e-983a-bd272b3aa8e8"},"children":[]},{"data":{"text":"依赖管理：Git子模块与包管理器整合","note":"依赖策略：核心库（引擎、渲染）用Git子模块锁定版本，确保可复现；工具库（JSON、日志）用包管理器简化获取。Git子模块：.gitmodules配置path和url，CI中git submodule update --init --recursive。CMake FetchContent：声明依赖和源码URL，自动下载构建，适合快速迭代。vcpkg：manifest模式vcpkg.json声明依赖，支持版本覆盖。Conan：conanfile.txt指定包和选项，生成CMake配置。关键： vendoring关键依赖，避免外部服务不可用导致构建失败。","nextSystemPrompt":"设计依赖更新自动化、安全漏洞扫描、许可证合规检查、离线构建支持方案","color":"#B35900","expand":true,"richText":false,"isActive":false,"uid":"9307060f-83f4-499c-8784-0a07616d6eeb"},"children":[]},{"data":{"text":"持续集成：多平台构建与自动化测试","note":"CI矩阵：GitHub Actions配置Ubuntu/macOS/Windows构建，交叉编译ARM/Android。构建阶段：依赖缓存→配置→编译→单元测试→集成测试→体积检查→产物打包。关键优化：ccache/sccache分布式缓存、Ninja并行编译、矩阵作业并发。测试：Headless模式运行Web Platform Tests子集，截图对比回归检测。产物：自动生成安装包（NSIS/DPKG/DMG）、符号包、更新清单。安全：代码签名（Windows EV证书、macOS公证）、SBOM生成。","nextSystemPrompt":"配置GitHub Actions工作流、Docker构建环境、测试覆盖率收集、自动发布到包仓库","color":"#8B0A50","expand":true,"richText":false,"isActive":false,"uid":"6e73d565-baff-4683-94f8-cd9560740d2a"},"children":[]},{"data":{"text":"分发优化：单文件打包与压缩技术","note":"目标：单一可执行文件，无外部依赖。技术：静态链接所有库（包括C++运行时）；资源嵌入（将HTML/JS/CSS编译为C数组，或打包为ZIP附加到可执行文件末尾）。压缩：UPX压缩可执行文件（启动时解压，适合磁盘敏感场景）；zstd压缩资源，内存解压；自解压存根设计。平台方案：Windows使用Enigma Virtual Box或自研PE资源节；macOS使用App Bundle或单文件通过@executable_path查找资源；Linux使用AppImage或静态链接。","nextSystemPrompt":"实现资源打包工具、运行时资源加载器、增量更新机制、数字签名验证","color":"#483D8B","expand":true,"richText":false,"isActive":false,"uid":"381f15af-2072-4a20-8b12-699631d4a8c3"},"children":[]}]},{"data":{"text":"核心功能实现：浏览引擎关键模块","note":"从零或基于开源库实现浏览器核心功能，需理解Web标准并做合理简化。关键模块：导航控制器管理历史记录和页面生命周期；文档加载器协调网络请求、解析、资源调度；渲染流水线将DOM+CSS转换为绘制命令；JS绑定桥接C++与脚本环境；事件系统处理输入并分发到正确元素。实现策略：参考标准但非完全兼容，优先常见场景；使用迭代开发，先静态页面再动态交互；性能关键路径用C++，配置逻辑用脚本或数据驱动。","nextSystemPrompt":"深入导航状态机、文档解析流水线、渲染树构建、JS引擎集成、事件分发机制的具体实现","color":"#8B0000","expand":true,"richText":false,"isActive":false,"uid":"a5d33ad0-2f89-4bea-9841-c188a2ec9273","dir":"left"},"children":[{"data":{"text":"导航与历史：多进程与单进程架构选择","note":"现代浏览器多用多进程架构（浏览器进程+渲染进程+GPU进程）隔离安全崩溃，但IPC开销大。最小化选择：单进程架构简化实现，所有组件同地址空间，内存共享高效，但单个页面崩溃影响全部。折中：站点隔离（per-site process）仅对跨域页面分离。导航实现：NavigationController维护会话历史（back/forward列表），处理pushState/replaceState；FrameTree管理子框架；Commit流程验证安全策略（CSP、X-Frame-Options）。关键：正确的生命周期管理避免内存泄漏。","nextSystemPrompt":"实现会话历史持久化、跨域导航安全策略、页面生命周期回调、崩溃恢复机制","color":"#4A0080","expand":true,"richText":false,"isActive":false,"uid":"60345efd-ff23-49cd-a473-5d201470122d"},"children":[]},{"data":{"text":"文档加载流水线：从URL到DOM的解析链","note":"加载流程：URL解析→DNS查询（缓存优先）→TCP/TLS连接→HTTP请求（Range支持断点续传）→响应处理（Content-Type嗅探、编码检测）→流式解析（HTMLTokenizer分词→TreeBuilder建DOM→增量布局）。优化：预连接（dns-prefetch, preconnect）、预加载（preload扫描器）、优先级调度（CSS/字体高优先级，图片低优先级）。错误处理：HTTP错误页、网络超时重试、SSL证书警告。关键：解析器与网络流的背压控制，避免内存膨胀。","nextSystemPrompt":"设计流式HTML解析器、资源优先级队列、增量布局触发策略、错误页面定制","color":"#006B3C","expand":true,"richText":false,"isActive":false,"uid":"03690e47-f0d8-46b0-b1c3-5535eb21694b"},"children":[]},{"data":{"text":"渲染流水线：布局计算与绘制优化","note":"渲染流程：DOM树 → 样式计算（匹配选择器，继承计算值）→ 布局树（仅可见元素，计算几何）→ 分层（will-change, iframe创建层）→ 绘制（生成绘制指令）→ 光栅化（CPU/GPU渲染为像素）→ 合成（层混合输出）。最小化简化：无层合成，直接绘制到目标表面；布局仅支持块流和Flex，无Grid；绘制使用简单遍历，无复杂裁剪优化。关键优化：脏矩形跟踪（仅重绘变化区域）、布局缓存（避免重复计算）、文本测量批处理。","nextSystemPrompt":"实现CSS盒模型布局、Flex布局算法、绘制指令生成、脏矩形跟踪与优化","color":"#B35900","expand":true,"richText":false,"isActive":false,"uid":"71a8f758-97aa-4f68-bbb1-cfa6fc55c64a"},"children":[]},{"data":{"text":"JS引擎绑定：C++与JavaScript互操作","note":"绑定层将DOM API暴露给JS，并将JS事件回调连接到C++。V8绑定：使用v8::Template创建对象模板，v8::FunctionTemplate定义构造函数，句柄作用域管理GC。QuickJS绑定：JS_NewCFunction创建C函数，JS_SetProperty设置对象属性，引用计数管理生命周期。关键设计：IDL生成绑定代码（参考Blink的bindings生成器），或手写模板减少依赖。性能：对象包装缓存避免重复创建，批量属性访问减少跨边界调用。安全：类型检查、异常处理、防止原型污染。","nextSystemPrompt":"设计IDL代码生成器、DOM对象包装类、事件监听管理、Promise与异步操作支持","color":"#8B4513","expand":true,"richText":false,"isActive":false,"uid":"b48ac446-48ce-4c64-b803-703c7385c20a"},"children":[]},{"data":{"text":"输入事件系统：从硬件到JS事件的流转","note":"事件流程：平台原生事件（Windows MSG, X11 Event）→ 浏览器转换（标准化坐标、修饰键）→ 命中测试（查找目标元素）→ 事件分发（捕获→目标→冒泡）→ JS处理（addEventListener回调）→ 默认行为（滚动、链接跳转、表单提交）。优化：事件合并（鼠标移动节流）、被动事件监听器（不阻塞滚动）、指针事件统一鼠标/触摸。实现：HitTestTree与布局树并行，使用包围盒快速剔除；事件队列避免重入；手势识别（双击缩放、惯性滚动）可简化或省略。","nextSystemPrompt":"实现命中测试算法、事件分发机制、默认行为处理、触摸手势识别基础","color":"#2F4F4F","expand":true,"richText":false,"isActive":false,"uid":"4f322e85-e0f5-4b94-b871-f6ca13ed16cc"},"children":[]},{"data":{"text":"资源管理：内存池与垃圾回收策略","note":"浏览器内存压力大：DOM树、样式数据、图像解码缓存、JS堆。策略：DOM节点使用侵入式链表+自定义分配器，快速批量释放；图像缓存LRU，解码后纹理上传GPU即释放CPU内存；JS引擎自带GC，但需控制对象包装的生命周期。监控：实现内存压力回调，触发缓存清理和JS强制GC。工具：集成 Tracy/Remotery 实时性能分析，自定义内存统计API。关键：避免循环引用（DOM节点与JS包装互相引用用弱引用打破），大文档分块加载。","nextSystemPrompt":"设计DOM节点分配器、图像缓存淘汰策略、内存压力响应机制、性能分析集成","color":"#006666","expand":true,"richText":false,"isActive":false,"uid":"4c7a7e13-77cb-4769-8ed4-989b030f968c"},"children":[]}]},{"data":{"text":"平台适配与部署：跨平台窗口系统集成","note":"最小化浏览器需适配目标平台的窗口系统和输入方式。桌面平台：Windows（Win32 API或现代WinUI 3）、macOS（Cocoa/AppKit）、Linux（X11或Wayland，推荐SDL2/glfw抽象）。嵌入式：直接操作帧缓冲（/dev/fb0）或EGLFS（无窗口管理器）。关键抽象：Surface管理（窗口/全屏/离屏）、输入设备（键盘/鼠标/触摸）、显示器特性（DPI、色彩空间）。部署策略：静态链接消除依赖，单一可执行文件，安装包适配各平台规范。","nextSystemPrompt":"分析各平台窗口创建、GL上下文管理、DPI适配、输入法集成的具体实现","color":"#191970","expand":true,"richText":false,"isActive":false,"uid":"4045bd15-a74e-41d8-8630-7e2d71272bbf","dir":"left"},"children":[{"data":{"text":"Windows平台：Win32 API与Modern UI","note":"传统方案：Win32 API创建窗口，处理WM_PAINT/WM_SIZE/WM_MOUSE/WM_KEY消息，DWM合成无需手动双缓冲。现代方案：Windows App SDK（WinUI 3）提供现代控件，但依赖运行时；WebView2封装Edge引擎，非最小化。优化：禁用视觉样式减少依赖，使用DirectComposition或Direct2D GPU加速，SetProcessDpiAwarenessContext处理高DPI。部署：静态链接VC++运行时，manifest声明DPI感知，signtool代码签名。关键：正确处理DPI变化时的重布局。","nextSystemPrompt":"实现高DPI窗口创建、Direct2D渲染集成、Windows IME输入、跳转列表与协议注册","color":"#4A0080","expand":true,"richText":false,"isActive":false,"uid":"4c5068c5-a5e8-493e-9030-f511baf9edbe"},"children":[]},{"data":{"text":"macOS平台：Cocoa与Metal渲染","note":"Cocoa框架：NSWindow/NSView创建窗口，重写drawRect或使用CALayer自定义渲染。渲染后端：OpenGL已废弃，推荐Metal（MTKView）或Core Graphics软件渲染。事件循环：NSApplicationMain或自定义CFRunLoop集成。沙盒：App Sandbox限制网络/文件访问，需entitlements配置。部署：创建.app bundle，Info.plist配置，hardened runtime，notarization公证。优化：使用CVDisplayLink实现VSync，支持深色模式（NSAppearance），触控板手势（NSEventPhase）。","nextSystemPrompt":"实现Metal渲染层、AppKit菜单集成、文本服务输入、沙盒权限配置、Sparkle更新","color":"#006B3C","expand":true,"richText":false,"isActive":false,"uid":"04d1e94c-35d7-4035-be26-f237bfebdbcf"},"children":[]},{"data":{"text":"Linux平台：X11、Wayland与SDL2抽象","note":"X11：传统选择，XCreateWindow创建，Xlib或xcb处理事件，GLX/EGL创建OpenGL上下文。Wayland：现代替代，无服务器端窗口装饰，需自绘标题栏，wl_compositor/wl_shell_surface协议。SDL2：跨平台抽象，SDL_CreateWindow统一接口，自动选择X11/Wayland，适合快速移植。关键：处理窗口管理器提示（_NET_WM_NAME, _NET_WM_STATE），EWMH全屏，DBus集成系统服务。部署：AppImage单文件分发，或依赖包管理器。嵌入式：直接DRM/KMS，无显示服务器。","nextSystemPrompt":"实现Wayland客户端协议、SDL2渲染后端切换、DBus菜单集成、屏幕键盘适配","color":"#B35900","expand":true,"richText":false,"isActive":false,"uid":"55463e02-a74d-481a-8fb4-f000b2e1b88c"},"children":[]},{"data":{"text":"嵌入式平台：帧缓冲与EGLFS直接渲染","note":"无窗口系统环境：直接操作Linux帧缓冲（mmap /dev/fb0，手动双缓冲），或使用Qt的EGLFS平台插件。EGLFS：创建全屏EGL窗口，GPU直接渲染，无合成器开销。输入：直接读取evdev（/dev/input/event*），解析输入事件协议，或tslib处理触摸屏。关键：内存受限（<256MB），禁用GPU时CPU软渲染，启动时间优化（<3秒）。Yocto/OpenEmbedded构建定制Linux发行版，仅包含必要库。典型硬件：i.MX6/Raspberry Pi/全志，交叉编译工具链配置。","nextSystemPrompt":"设计帧缓冲双缓冲方案、evdev输入处理、启动时间优化、OTA更新机制","color":"#8B4513","expand":true,"richText":false,"isActive":false,"uid":"03ab0cdb-d7b4-4680-8e01-39aa86482f02"},"children":[]},{"data":{"text":"移动端适配：Android与iOS基础方案","note":"Android：NativeActivity或JNI桥接Java层，ANativeWindow获取Surface，AInputQueue处理触摸。推荐：使用Flutter Engine或自定义SurfaceView嵌入。iOS：UIKit的UIView或直接使用CAEAGLLayer/MTKView，需Objective-C++混合编译。限制：App Store审核要求，iOS必须允许JIT替代方案（WKWebView包装或解释执行）。最小化策略：共享桌面端C++核心，平台层仅实现Surface和输入抽象，JNI/Objective-C++薄封装。构建：CMake配合Android NDK，Xcode项目生成。","nextSystemPrompt":"实现Android SurfaceFlinger集成、iOS Metal渲染、触摸手势处理、应用生命周期管理","color":"#8B0A50","expand":true,"richText":false,"isActive":false,"uid":"a885ad98-f009-4d46-8653-2b4da5340bc2"},"children":[]},{"data":{"text":"部署打包：安装程序与自动更新","note":"Windows：NSIS或WiX创建安装程序，支持静默安装，注册协议处理程序，创建快捷方式。macOS：DMG或.pkg，Sparkle框架实现自动更新。Linux：DEB/RPM包，或AppImage单文件。通用：自定义更新协议，检查manifest差异，下载增量包，验证签名，原子替换。安全：代码签名防止篡改，HTTPS下载，哈希校验。关键：首次启动配置向导，崩溃报告收集（Sentry集成），遥测可选启用。企业部署：MSI组策略，MDM配置管理。","nextSystemPrompt":"实现增量更新算法、后台下载服务、签名验证流程、崩溃报告收集系统","color":"#483D8B","expand":true,"richText":false,"isActive":false,"uid":"9f0e63b4-7ca4-4b58-a38c-10058ae5b670"},"children":[]}]},{"data":{"text":"测试验证与性能优化：质量保证体系","note":"最小化浏览器需建立适合的测试策略，平衡覆盖率与维护成本。测试金字塔：单元测试（核心算法，>70%覆盖）、集成测试（模块交互）、端到端测试（关键用户场景）。参考测试：Web Platform Tests子集，针对实现的功能；自定义测试页面验证布局、JS API、性能基准。性能：启动时间（冷/热启动）、内存占用（空标签/复杂页面）、渲染帧率（滚动/动画）、JS执行速度。工具：内置性能面板，远程调试协议（Chrome DevTools Protocol子集），日志分级。","nextSystemPrompt":"设计测试框架选型、基准测试页面、性能剖析工具、回归检测自动化方案","color":"#2E8B57","expand":true,"richText":false,"isActive":false,"uid":"79f8d69b-4eac-412e-afc7-cbbd1b323a91","dir":"left"},"children":[{"data":{"text":"单元测试：核心模块的自动化验证","note":"框架选择：Google Test（C++标准，丰富匹配器），Catch2（单头文件，简单），doctest（编译速度优先）。测试策略：URL解析、HTML/CSS解析器、布局算法、数据结构等纯逻辑模块优先覆盖；平台相关代码使用mock抽象。组织：与源码同目录或tests/平行目录，CMake CTest集成。质量：目标行覆盖率>70%，关键路径>90%；使用gcov/lcov生成报告；变异测试（mull）验证测试有效性。CI集成：每次提交自动运行，失败阻断合并，覆盖率下降告警。","nextSystemPrompt":"编写URL解析测试用例、布局算法验证、mock平台抽象、覆盖率报告集成","color":"#4A0080","expand":true,"richText":false,"isActive":false,"uid":"01feca00-5ec7-4cd1-9004-72b3b8d9d86a"},"children":[]},{"data":{"text":"集成测试：端到端场景与WPT兼容","note":"测试方法：Headless模式运行（无窗口渲染），截图对比检测渲染回归；自动化操作（点击、输入、导航）验证交互流程。Web Platform Tests：选取与实现功能相关的测试子集，跳过不支持的特性，标记预期失败。自定义测试：HTML页面集合覆盖常见布局模式、JS API使用、性能边界情况。工具：自研测试驱动或集成Playwright/Puppeteer（控制外部浏览器，非自研）。关键：稳定的测试环境（固定字体、时区、屏幕尺寸），避免 flaky test。","nextSystemPrompt":"实现Headless渲染模式、截图对比算法、WPT测试筛选、自动化测试页面集","color":"#006B3C","expand":true,"richText":false,"isActive":false,"uid":"b6a68608-8422-4eaa-9991-a56c3c8f4eef"},"children":[]},{"data":{"text":"性能基准：启动、内存与渲染指标","note":"关键指标：冷启动时间（进程创建到首屏显示，目标<500ms）、热启动时间（<100ms）、内存基线（空标签<50MB）、复杂页面峰值（控制增长斜率）、渲染帧率（60fps滚动）。测试方法：内置性能计时API（performance.now高精度计时），内存统计（mallinfo, GetProcessMemoryInfo），GPU计时（GL_TIMESTAMP）。基准页面：Speedometer子集（DOM操作）、MotionMark简化（动画）、自定义压力测试（大表格、深嵌套DOM）。监控：持续集成记录趋势，回归自动告警。","nextSystemPrompt":"设计性能计时埋点、内存分析工具、渲染性能剖析、基准测试自动化报告","color":"#B35900","expand":true,"richText":false,"isActive":false,"uid":"bcd46305-17df-4d7e-8dcf-4542e14c5049"},"children":[]},{"data":{"text":"调试工具：远程调试与日志系统","note":"最小化仍需基础调试能力：日志系统分级（Verbose/Debug/Info/Warning/Error），运行时过滤，文件/控制台/回调输出。远程调试：实现Chrome DevTools Protocol子集，支持Inspector连接，查看DOM、CSS、控制台日志。简化方案：内置调试面板（Ctrl+Shift+I触发），显示基本树结构和计算样式。崩溃处理：信号捕获（segfault），堆栈回溯（libbacktrace, dbghelp），minidump生成，上传服务。关键：发布构建保留最小符号，用户可自愿发送崩溃报告。","nextSystemPrompt":"实现CDP协议子集、日志分级过滤、崩溃堆栈收集、远程调试前端界面","color":"#8B4513","expand":true,"richText":false,"isActive":false,"uid":"be1f63ce-77b3-4f31-b2f1-e65ac8e0c72a"},"children":[]},{"data":{"text":"安全加固：沙箱与漏洞缓解措施","note":"即使最小化也需基础安全：网络隔离（CSP默认限制）、内容安全（HTML/JS解析严格模式，防止内存损坏）。沙箱：多进程架构中渲染进程降权（Linux seccomp-bpf, Windows sandbox, macOS seatbelt），限制文件/网络访问。缓解措施：编译器（Stack Canary, ASan/NASan检测, Control Flow Integrity），链接器（RELRO, PIE, NX bit）。更新：自动安全更新机制，CVE监控依赖库。审计：静态分析（Clang Static Analyzer, Coverity），模糊测试（libFuzzer针对解析器）。","nextSystemPrompt":"实现seccomp策略配置、渲染进程隔离、模糊测试目标、漏洞响应流程","color":"#8B0000","expand":true,"richText":false,"isActive":false,"uid":"f9f2874a-b54b-4646-90a2-c7ebd6031769"},"children":[]},{"data":{"text":"持续优化：性能剖析与代码精简","note":"优化流程：性能剖析识别热点（CPU采样、内存分配跟踪）→ 针对性优化算法或数据结构 → 验证改进 → 回归测试防止退化。工具：内置Tracy/Optick集成，或平台原生工具（Instruments, VTune, perf）。精简：定期审查代码体积贡献，移除未用功能（dead code elimination），条件编译控制可选模块。技术债务：定期重构复杂模块，更新依赖版本，清理兼容代码。用户反馈：内置简易反馈渠道，性能问题自动收集环境信息。","nextSystemPrompt":"集成Tracy实时分析、热点函数优化、代码体积分析、用户反馈收集系统","color":"#006666","expand":true,"richText":false,"isActive":false,"uid":"4a10420a-6dc1-467b-a406-97b2fcbcb184"},"children":[]}]}],"smmVersion":"0.14.0-fix.1"}